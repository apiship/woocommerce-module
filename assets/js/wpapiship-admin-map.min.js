!function(t){"use strict";if("undefined"!=typeof WPApiShipAdmin&&"undefined"!=typeof WPApiShipAdminMap){var i={parseBool:function(t){return!/^(false|0)$/i.test(t)&&!!t},listPointsOut:null,map:null,existsYmaps:function(){return"undefined"!=typeof ymaps},isMapExists:function(){return null!==i.map&&"object"==typeof i.map},getBalloonContent:function(t){var i='<div class="point-out-balloon-content">';return i+='<div class="provider-key">Служба доставки: '+WPApiShipAdmin.getShippingMethodMeta("tariffProviderKey","value"),i+="</div>",i+='<div class="point-out-address">'+t.streetType+"."+t.street+", д."+t.house,"2"==t.availableOperation&&(i+=" ("+WPApiShipAdmin.__("postamat")+")"),i+="</div>",i+="<br />",i+='<div class="description">',i+=t.description,i+="</div>",i+="<br />",i+='<div class="point-out-select-wrapper">',i+='<a href="#" data-id="'+t.id+'" data-address="'+t.address+'" onclick="return false;" class="point-out-select button button-secondary">'+WPApiShipAdmin.__("Select")+"</a>",i+="</div>",i+="</div>"},getCaption:function(t){var i=t.street+", д."+t.house;return"2"==t.availableOperation&&(i+="(постамат)"),i},placePointOutToMap:function(t){i.map.geoObjects.add(new ymaps.Placemark([t.lat,t.lng],{balloonContent:i.getBalloonContent(t),iconCaption:i.getCaption(t)},{preset:"islands#icon",iconColor:"#0000ff"}))},newMap:function(){i.map=new ymaps.Map("wpapiship-ymap",{center:[55.753909,37.620938],zoom:12},{searchControlProvider:"yandex#search"})},mapInit:function(){if(null!==i.listPointsOut){var t=WPApiShipAdmin.getParam("currentPointOutData"),n=!1,e=null;i.listPointsOut.rows.map((function(a){null===e&&a.countryCode==WPApiShipAdmin.getParam("wcCountryCode")&&(e=a),(e=>{i.parseBool(t)&&t.id===e.id&&(n=e)})(a),null===i.map&&i.newMap(),i.placePointOutToMap(a)})),n?i.map.setCenter([n.lat,n.lng]):i.map.setCenter([e.lat,e.lng])}},startMap:function(){var t={action:"getListPointsOut",city:WPApiShipAdmin.getParam("wcShipping")._shipping_city,providerKey:WPApiShipAdmin.getShippingMethodMeta("tariffProviderKey","value"),availableOperation:"[2,3]",doneCallback:t=>{if(void 0!==t&&t.success){try{i.listPointsOut=JSON.parse(t.data.response.body)}catch{return void console.log("getListPointsOut:: parsing error.")}ymaps.ready(i.mapInit)}}};WPApiShipAdmin.ajax(t)},warning:function(){t(WPApiShipAdmin.getParam("ymapSelector")).text("").text(WPApiShipAdmin.__("notYMap")).addClass("not-ymap").toggleClass("hidden")},attachListeners:function(){t(document).on("click",".point-out-select",(function(i){t(document).trigger("selectPointOut",[t(this)])})),t("#wpapiship-order-metabox .edit-data").on("click",(function(n){if(t(this).hasClass("edit-point-out")){if(!i.existsYmaps())return void i.warning();i.isMapExists()||i.startMap(),t(WPApiShipAdmin.getParam("ymapSelector")).toggleClass("hidden")}}))},start:function(){"post.php"==WPApiShipAdmin.getParam("pagenow")&&"shop_order"==WPApiShipAdmin.getParam("post_type")&&i.attachListeners()}};WPApiShipAdminMap=t.extend({},WPApiShipAdminMap,i),WPApiShipAdminMap.start()}}(jQuery);