!function(i){"use strict";var o;"undefined"!=typeof WPApiShipAdmin&&"undefined"!=typeof WPApiShipAdminMap&&(o={parseBool:function(t){return!/^(false|0)$/i.test(t)&&!!t},listPointsOut:null,map:null,existsYmaps:function(){return"undefined"!=typeof ymaps},isMapExists:function(){return null!==o.map&&"object"==typeof o.map},getBalloonContent:function(t){var i='<div class="point-out-balloon-content">';return i+='<div class="provider-key">Служба доставки: '+WPApiShipAdmin.getShippingMethodMeta("tariffProviderKey","value"),i+="</div>",i+='<div class="point-out-address">'+t.streetType+"."+t.street+", д."+t.house,"2"==t.availableOperation&&(i+=" ("+WPApiShipAdmin.__("postamat")+")"),i+="</div>",i+="<br />",i+='<div class="description">',i+=t.description,i+="</div>",i+="<br />",i+='<div class="point-out-select-wrapper">',i+='<a href="#" data-id="'+t.id+'" data-address="'+t.address+'" onclick="return false;" class="point-out-select button button-secondary">'+WPApiShipAdmin.__("Select")+"</a>",i+="</div>",i+="</div>"},getCaption:function(t){var i=t.street+", д."+t.house;return"2"==t.availableOperation&&(i+="(постамат)"),i},placePointOutToMap:function(t){o.map.geoObjects.add(new ymaps.Placemark([t.lat,t.lng],{balloonContent:o.getBalloonContent(t),iconCaption:o.getCaption(t)},{preset:"islands#icon",iconColor:"#0000ff"}))},newMap:function(){o.map=new ymaps.Map("wpapiship-ymap",{center:[55.753909,37.620938],zoom:12},{searchControlProvider:"yandex#search"})},mapInit:function(){var n,e,a;null!==o.listPointsOut&&(n=WPApiShipAdmin.getParam("currentPointOutData"),e=!1,a=null,o.listPointsOut.rows.map(function(t){var i;null===a&&t.countryCode==WPApiShipAdmin.getParam("wcCountryCode")&&(a=t),i=t,o.parseBool(n)&&n.id===i.id&&(e=i),null===o.map&&o.newMap(),o.placePointOutToMap(t)}),e?o.map.setCenter([e.lat,e.lng]):o.map.setCenter([a.lat,a.lng]))},startMap:function(){var t={action:"getListPointsOut",city:WPApiShipAdmin.getParam("wcShipping")._shipping_city,providerKey:WPApiShipAdmin.getShippingMethodMeta("tariffProviderKey","value"),availableOperation:"[2,3]",doneCallback:t=>{if(void 0!==t&&t.success){try{o.listPointsOut=JSON.parse(t.data.response.body)}catch{return void console.log("getListPointsOut:: parsing error.")}ymaps.ready(o.mapInit)}}};WPApiShipAdmin.ajax(t)},warning:function(){i(WPApiShipAdmin.getParam("ymapSelector")).text("").text(WPApiShipAdmin.__("notYMap")).addClass("not-ymap").toggleClass("hidden")},attachListeners:function(){i(document).on("click",".point-out-select",function(t){i(document).trigger("selectPointOut",[i(this)])}),i("#wpapiship-order-metabox .edit-data").on("click",function(t){i(this).hasClass("edit-point-out")&&(o.existsYmaps()?(o.isMapExists()||o.startMap(),i(WPApiShipAdmin.getParam("ymapSelector")).toggleClass("hidden")):o.warning())})},start:function(){"post.php"==WPApiShipAdmin.getParam("pagenow")&&"shop_order"==WPApiShipAdmin.getParam("post_type")&&o.attachListeners()}},(WPApiShipAdminMap=i.extend({},WPApiShipAdminMap,o)).start())}(jQuery);